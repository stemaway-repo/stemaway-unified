<script type="text/discourse-plugin" version="0.6">
  const ajax = require('discourse/lib/ajax').ajax;
  const Topic = require('discourse/models/topic').default;

  api.registerConnectorClass('below-site-header', 'experts-homepage', {
      actions: {
          hideHomepage(){
              this.set('collapseHomepage', true);
              $.cookie('collapse-homepage', true);
              $('html').addClass('collapse-experts-homepage');
          },
          showHomepage(){
              this.set('collapseHomepage', false);
              $.cookie('collapse-homepage', false);
              $('html').removeClass('collapse-experts-homepage');
          }
      },
      shouldRender(args, component) {
          return true;
      },
      setupComponent(args, component) {
          if ($.cookie('collapse-homepage') == "true"){
              component.set('collapseHomepage', true);
              $('html').addClass('collapse-experts-homepage');
          }
          else{
              component.set('collapseHomepage', false);
              $('html').removeClass('collapse-experts-homepage');
          }
          component.set('hostname', window.location.hostname);

          api.onPageChange((url, title) => {
              if (url == "/" ) {
                  component.set('displayCustomHomepageBlocks', true);
              }
              else {
                  component.set('displayCustomHomepageBlocks', false);
              };

              if (url == "/" || settings.additional_banner_urls.split('|').includes(url)) {
                  $('html').addClass('show-experts-homepage');
                  component.set('displayCustomHomepageHeader', true);
              }
              else {
                  $('html').removeClass('show-experts-homepage');
                  $('#main-outlet a').click(function(){
                      if ($(this).attr('href') == "/"){
                          component.set('displayCustomHomepageHeader', true);
                          $('.below-site-header-outlet.experts-homepage').removeClass("hidden");
                      }
                  });
                  $('.d-header .title').click(function(){
                      component.set('displayCustomHomepageHeader', true);
                      $('.below-site-header-outlet.experts-homepage').removeClass("hidden");
                  });
                  component.set('displayCustomHomepageHeader', false);
              }
          });
      }
  });
</script>
<script
  type="text/x-handlebars"
  data-template-name="/connectors/below-site-header/experts-homepage"
>
  {{#if displayCustomHomepageHeader}}
  <section class="jumbotron experts-homepage">
      <div class="jumbotron-image">
          <img loading="lazy" src="{{ theme-setting 'hero_image' }}" alt="">
      </div>
      <div class="jumbotron-titles">
        <h1 id="cover_title">{{{theme-setting 'cover_title_collapsed'}}}</h1>
        <h2 id="cover_subtitle">{{{theme-setting 'cover_subtitle_collapsed'}}}</h2>
      </div>
      <div class="jumbotron-quick-links">
          <div class="jumbotron-quick-links-container">
              <h3>Quick Links</h3>
              <ul>

                  <li><a href=""><svg class="fa d-icon d-icon-{{ theme-setting 'ebox_1_icon_url' }} svg-icon svg-node" aria-hidden="true"><use xlink:href="#{{ theme-setting 'ebox_1_icon_url' }}"></use></svg>{{theme-setting 'ebox_1_text'}}</a></li>
                  <li><a href=""><svg class="fa d-icon d-icon-{{ theme-setting 'ebox_2_icon_url' }} svg-icon svg-node" aria-hidden="true"><use xlink:href="#{{ theme-setting 'ebox_2_icon_url' }}"></use></svg>{{theme-setting 'ebox_2_text'}}</a></li>
                  <li><a href=""><svg class="fa d-icon d-icon-{{ theme-setting 'ebox_3_icon_url' }} svg-icon svg-node" aria-hidden="true"><use xlink:href="#{{ theme-setting 'ebox_3_icon_url' }}"></use></svg>{{theme-setting 'ebox_3_text'}}</a></li>
                  <li><a href=""><svg class="fa d-icon d-icon-{{ theme-setting 'ebox_4_icon_url' }} svg-icon svg-node" aria-hidden="true"><use xlink:href="#{{ theme-setting 'ebox_4_icon_url' }}"></use></svg>{{theme-setting 'ebox_4_text'}}</a></li>
              </ul>
          </div>
      </div>
    </section>
    {{/if}}
</script>
<script type="text/javascript">
  $(document).ready(function (e) {
    $(".experts-homepage.ember-view").on(
      "click",
      "#homepage-banner-link-help-others",
      function (e) {
        e.preventDefault();

        if (Discourse.User.current()) {
          // If logged in, click the "create topic" button
          $("#create-topic").click();
        } else {
          // If logged out, navigate to the home page
          window.location.href = "/";
        }
      }
    );

    $(".experts-homepage.ember-view").on(
      "click",
      ".homepage-banner-link-share-link",
      function (e) {
        e.preventDefault();
        $("#create-topic").click();
      }
    );

    $(".experts-homepage.ember-view").on(
      "click",
      "#homepage-banner-link-get-help",
      function (e) {
        if (!Discourse.User.current()) {
          // If logged out, navigate to the home page
          e.preventDefault();
          window.location.href = "/";
        }
      }
    );
  });
</script>
<script type="text/discourse-plugin" version="0.6">
  const ajax = require('discourse/lib/ajax').ajax;
  const Topic = require('discourse/models/topic').default;

  api.registerConnectorClass('above-footer', 'experts-homepage', {
      actions: {
          hideHomepage(){
              this.set('collapseHomepage', true);
              $.cookie('collapse-homepage', true);
              $('html').addClass('collapse-experts-homepage');
          },
          showHomepage(){
              this.set('collapseHomepage', false);
              $.cookie('collapse-homepage', false);
              $('html').removeClass('collapse-experts-homepage');
          }
      },
      shouldRender(args, component) {
          return true;
      },
      setupComponent(args, component) {
          if ($.cookie('collapse-homepage') == "true"){
              component.set('collapseHomepage', true);
              $('html').addClass('collapse-experts-homepage');
          }
          else{
              component.set('collapseHomepage', false);
              $('html').removeClass('collapse-experts-homepage');
          }
          component.set('hostname', window.location.hostname);

          api.onPageChange((url, title) => {
              if (url == "/" ) {
                  $('html').addClass('show-experts-homepage');
                  component.set('displayCustomHomepage', true);
                  $('#main-outlet a').click(function(event){
                      $('.above-footer-outlet.experts-homepage').addClass("hidden");
                      component.set('displayCustomHomepage', false);
                  });
                  ajax(settings.topic_list_1_content_url).then (function(result){
                      topicListOne = [];
                      var usersOne = result.users;
                      result.topic_list.topics.slice(0,5).forEach(function(topic){
                          topic.posters.forEach(function(poster){
                              poster.user = $.grep(usersOne, function(e){ return e.id == poster.user_id; })[0];
                          });
                          topicListOne.push(Topic.create(topic));
                      });
                      component.set('topicListOne', topicListOne);
                  });
                  ajax(settings.topic_list_2_content_url).then (function(result){
                      topicListTwo = [];
                      var usersTwo = result.users;
                      result.topic_list.topics.slice(0,5).forEach(function(topic){
                          topic.posters.forEach(function(poster){
                              poster.user = $.grep(usersTwo, function(e){ return e.id == poster.user_id; })[0];
                          });
                          topicListTwo.push(Topic.create(topic));
                      });
                      component.set('topicListTwo', topicListTwo);
                  });
                  ajax(settings.topic_list_3_content_url).then (function(result){
                      var usersThree = result.users;
                      component.set('topicListThree', result.topic_list.topics.slice(0,3));
                  });
              }
              else {
                  $('html').removeClass('show-experts-homepage');
                  $('#main-outlet a').click(function(){
                      if ($(this).attr('href') == "/"){
                          component.set('displayCustomHomepage', true);
                          $('.above-footer-outlet.experts-homepage').removeClass("hidden");
                      }
                  });
                  $('.d-header .title').click(function(){
                      component.set('displayCustomHomepage', true);
                      $('.above-footer-outlet.experts-homepage').removeClass("hidden");
                  });
                  component.set('displayCustomHomepage', false);
              }
          });
      }
  });
</script>
